# Coturn TURN server configuration for VoxMatrix
# https://github.com/coturn/coturn

# Network listening interfaces
listening-port=3478
tls-listening-port=5349

# Relay ports for media traffic
min-port=49152
max-port=49200

# TURN server authentication
# Use static-auth-secret for Docker environments
lt-cred-mech
user=${TURN_USERNAME}:${TURN_PASSWORD}

# TLS/DTLS configuration
# Generate certificates with Let's Encrypt or use your own
# cert=/var/coturn/cert.pem
# pkey=/var/coturn/privkey.pem
# ca-file=/var/coturn/chain.pem

# Use Docker host IP
external-ip=${SERVER_IP}

# STUN/TURN server functionality
fingerprint
lt-cred-mech

# Keep alive packets
stale-nonce
keep-address-family

# No CLI access
no-cli

# Log configuration
log-file=/var/coturn/turnserver.log
simple-log
verbose

# Enable debugging (comment out in production)
# verbose

# Realm
realm=${SERVER_NAME}

# Allow connections from any origin (restrict in production)
no-stdout-log

# Limit connections
total-quota=300
bps-capacity=6000000

# Channel data and bandwidth limits
max-bps=3000000

# Security settings
no-multicast-peers
secure-stun

# Mobility
mobility

# Timeouts
stale-nonce=600

# Disable DTLS if not needed
# no-dtls

# REST API for secret-based auth (optional)
# rest-api-port=8080
# rest-api-secret=${TURN_SHARED_SECRET}

# Redis for allocation storage (optional, for HA)
# redis-ip=redis
# redis-port=6379

# Performance tuning
max-allocate-lifetime=3600
max-channel-lifetime=1800
max-lifetime=3600

# Deny specific peer IPs if needed (block malicious IPs)
# denied-peer-ip=0.0.0.0-0.255.255.255
# denied-peer-ip=10.0.0.0-10.255.255.255
# denied-peer-ip=127.0.0.0-127.255.255.255
# denied-peer-ip=172.16.0.0-172.31.255.255
# denied-peer-ip=192.168.0.0-192.168.255.255

# Only allow specific peer IPs (restrictive mode, use carefully)
# allowed-peer-ip=1.2.3.4

# User quota
user-quota=12

# DNS configuration
use-dhcp-range

# Syslog
syslog
